(function(f){function s(x){function w(){}w.prototype=x||this;return new w()}var h={};h.settings={};h.Error={toString:function(){return"RecurlyJS Error: "+this.message}};h.raiseError=function(w){var x=s(h.Error);x.message=w;throw x};h.config=function(w){f.extend(true,h.settings,w);if(!w.baseURL){switch(h.settings.environment){case"sandbox":h.settings.baseURL="https://api-sandbox.recurly.com/jsonp/";break;case"production":h.settings.baseURL="https://api-production.recurly.com/jsonp/";break;default:h.raiseError("environment not configured (sandbox or production)");break}var x=h.settings.subdomain||h.raiseError("company subdomain not configured");h.settings.baseURL+=x+"/"}};function r(x,w){if(x==1){return w.substr(0,w.length-1)}return""+x+" "+w}(h.Cost=function(w){this._cents=w||0}).prototype={toString:function(){return h.formatCurrency(this.dollars())},cents:function(w){if(w===undefined){return this._cents}return new Cost(w)},dollars:function(w){if(w===undefined){return this._cents/100}return new h.Cost(w*100)},mult:function(w){return new h.Cost(this._cents*w)},add:function(w){if(w.cents){w=w.cents()}return new h.Cost(this._cents+w)},sub:function(w){if(w.cents){w=w.cents()}return new h.Cost(this._cents-w)}};h.Cost.FREE=new h.Cost(0);(h.TimePeriod=function(x,w){this.length=x;this.unit=w}).prototype={toString:function(){return""+r(this.length,this.unit)},toDate:function(){var w=new Date();switch(this.unit){case"month":w.setMonth(w.getMonth()+this.length);break;case"day":w.setDay(w.getDay()+this.length);break}return w},clone:function(){return new h.TimePeriod(this.length,this.unit)}};(h.RecurringCost=function(x,w){this.cost=x;this.interval=w}).prototype={toString:function(){return""+this.cost+" every "+this.interval},clone:function(){return new h.TimePeriod(this.length,this.unit)}};h.RecurringCost.FREE=new h.RecurringCost(0,null);(h.RecurringCostStage=function(w,x){this.recurringCost=w;this.duration=x}).prototype={toString:function(){this.recurringCost.toString()+" for "+this.duration.toString()}};h.locale={};h.locale.errors={emptyField:"Required field",missingFullAddress:"Please enter your full address.",invalidEmail:"Invalid",invalidCC:"Invalid",invalidCVV:"Invalid",invalidCoupon:"Invalid",cardDeclined:"Transaction declined",acceptTOS:"Please accept the Terms of Service."};h.locale.currencies={};h.locale.currency={format:"%u%n",separator:".",delimiter:",",precision:2};function p(w,x){var z=h.locale.currencies[w]=s(h.locale.currency);for(var y in x){z[y]=x[y]}}p("USD",{symbol:"$"});p("AUD",{symbol:"$"});p("CAD",{symbol:"$"});p("EUR",{symbol:"\u20ac"});p("GBP",{symbol:"\u00a3"});p("CZK",{symbol:"\u004b"});p("DKK",{symbol:"\u6b72"});p("HUF",{symbol:"Ft"});p("JPY",{symbol:"\u00a5"});p("NOK",{symbol:"kr"});p("NZD",{symbol:"$"});p("PLN",{symbol:"\u007a"});p("SGD",{symbol:"$"});p("SEK",{symbol:"kr"});p("CHF",{symbol:"Fr"});p("ZAR",{symbol:"R"});h.settings.locale=h.locale;h.detectCardType=function(w){w=w.replace(/\D/g,"");var y=[{name:"visa",prefixes:[4]},{name:"mastercard",prefixes:[51,52,53,54,55]},{name:"american_express",prefixes:[34,37]},{name:"discover",prefixes:[6011,62,64,65]},{name:"diners_club",prefixes:[305,36,38]},{name:"carte_blanche",prefixes:[300,301,302,303,304,305]},{name:"jcb",prefixes:[35]},{name:"enroute",prefixes:[2014,2149]},{name:"solo",prefixes:[6334,6767]},{name:"switch",prefixes:[4903,4905,4911,4936,564182,633110,6333,6759]},{name:"maestro",prefixes:[5018,5020,5038,6304,6759,6761]},{name:"visa",prefixes:[417500,4917,4913,4508,4844]},{name:"laser",prefixes:[6304,6706,6771,6709]}];for(var z=0;z<y.length;z++){for(var x=0;x<y[z].prefixes.length;x++){if(new RegExp("^"+y[z].prefixes[x].toString()).test(w)){return y[z].name}}}};h.formatCurrency=function(z,D){if(z<0){z=-z;var y=true}else{var y=false}D=D||h.settings.currency||h.raiseError("currency not configured");var C=h.locale.currency;var x=h.locale.currencies[D];var B=z.toFixed(x.precision);if(C.separator!="."){B=B.replace(/\./g,C.separator)}function w(F){var E=new RegExp("(-?[0-9]+)([0-9]{3})");while(E.test(F)){F=F.replace(E,"$1"+C.delimiter+"$2")}return F}B=w(B);var A=C.format;A=A.replace(/%u/g,x.symbol);A=A.replace(/%n/g,B);B=A;if(y){B="-"+B}return B};var l=["AT","BE","BG","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];h.isCountryInEU=function(w){return f.inArray(w,l)!==-1};h.isVATNumberApplicable=function(x,w){if(!h.settings.VATPercent){return false}if(!h.settings.country){h.raiseError("you must configure a country for VAT to work")}if(!h.isCountryInEU(h.settings.country)){h.raiseError("you cannot charge VAT outside of the EU")}if(!h.isCountryInEU(x)){return false}return true};h.isVATChargeApplicable=function(x,y){if(!h.isVATNumberApplicable(x)){return false}var w=h.settings.country;return(w==x||!y)};h.flattenErrors=function(D,x){var w=[];var A=["base","account_id"];var x=x||"";if(typeof D=="string"||typeof D=="number"||typeof D=="boolean"){if(f.inArray(A,x)){return[D]}return[""+x+" "+D]}for(var z in D){if(D.hasOwnProperty(z)){x=(parseInt(z).toString()==z)?x:z;var C=h.flattenErrors(D[z],x);for(var B=0,y=C.length;B<y;++B){w.push(C[B])}}}return w};h.replaceVars=function(z,y){for(var x in y){if(y.hasOwnProperty(x)){var w=encodeURIComponent(y[x]);z=z.replace(new RegExp("\\{"+x+"\\}","g"),w)}}return z};h.post=function(x,A,w){if(w.resultNamespace){var B={};B[w.resultNamespace]=A;A=B}var y=f("<form />").hide();y.attr("action",x).attr("method","POST").attr("enctype","application/x-www-form-urlencoded");function z(D,G,F){var C=(F.length>0?(F+"["+D+"]"):D);if(typeof G==="object"){for(var E in G){if(G.hasOwnProperty(E)){z(E,G[E],C)}}}else{f('<input type="hidden" />').attr({name:C,value:G}).appendTo(y)}}z("",A,"");f("body").append(y);y.submit()};(h.isValidCC=function(C){var x=C.val();if(/[^0-9-]+/.test(x)){return false}var A=0,z=0,w=false;x=x.replace(/\D/g,"");for(var B=x.length-1;B>=0;B--){var y=x.charAt(B);var z=parseInt(y,10);if(w){if((z*=2)>9){z-=9}}A+=z;w=!w}return(A%10)==0}).defaultErrorKey="invalidCC";(h.isValidEmail=function(x){var w=x.val();return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(w)}).defaultErrorKey="invalidEmail";function b(w){return/^[0-9]+$/.test(w)}(h.isValidCVV=function(x){var w=x.val();return(w.length==3||w.length==4)&&b(w)}).defaultErrorKey="invalidCVV";(h.isNotEmpty=function(x){var w=x.val();return !!w}).defaultErrorKey="emptyField";(h.isChecked=function(w){return w.is(":checked")}).defaultErrorKey="acceptTOS";h.Plan={create:s,fromJSON:function(z){var A=this.create();A.name=z.name;A.code=z.plan_code;A.cost=new h.Cost(z.unit_amount_in_cents);A.displayQuantity=z.display_quantity;A.interval=new h.TimePeriod(z.plan_interval_length,z.plan_interval_unit);if(z.trial_interval_length){A.trial=new h.TimePeriod(z.trial_interval_length,z.trial_interval_unit)}if(z.setup_fee_in_cents){A.setupFee=new h.Cost(z.setup_fee_in_cents)}A.addOns=[];if(z.add_ons){for(var x=z.add_ons.length,y=0;y<x;++y){var w=z.add_ons[y];A.addOns.push(h.AddOn.fromJSON(w))}}return A},get:function(w,x){f.ajax({url:h.settings.baseURL+"plans/"+w,dataType:"jsonp",jsonp:"callback",timeout:10000,success:function(y){var z=h.Plan.fromJSON(y);x(z)}})},createSubscription:function(){var w=s(h.Subscription);w.plan=s(this);w.plan.quantity=1;w.addOns=[];return w}};h.AddOn={fromJSON:function(x){var w=s(h.AddOn);w.name=x.name;w.code=x.add_on_code;w.cost=new h.Cost(x.default_unit_amount_in_cents);w.displayQuantity=x.display_quantity;return w},toJSON:function(){return{name:this.name,add_on_code:this.code,default_unit_amount_in_cents:this.default_unit_amount_in_cents}}};h.Account={create:s,toJSON:function(){return{first_name:this.firstName,last_name:this.lastName,company_name:this.companyName,account_code:this.code,email:this.email}}};h.BillingInfo={create:s,toJSON:function(){return{first_name:this.firstName,last_name:this.lastName,month:this.month,year:this.year,number:this.number,verification_value:this.cvv,address1:this.address1,address2:this.address2,city:this.city,state:this.state,zip:this.zip,country:this.country,phone:this.phone}},save:function(w){var x={billing_info:this.toJSON(),signature:w.signature};if(!w.distinguishContactFromBillingInfo){x.account={account_code:w.accountCode,first_name:this.firstName,last_name:this.lastName}}f.ajax({url:h.settings.baseURL+"accounts/"+w.accountCode+"/billing_info/update",data:x,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(y){if(y.success&&w.success){w.success(y.success)}else{if(y.errors&&w.error){w.error(h.flattenErrors(y.errors))}}},error:function(){if(w.error){w.error(["Unknown error processing transaction. Please try again later."])}},complete:w.complete||f.noop})}};h.Subscription={create:s,plan:h.Plan,addOns:[],calculateTotals:function(){var z={stages:{}};z.plan=this.plan.cost.mult(this.plan.quantity);z.allAddOns=new h.Cost(0);z.addOns={};for(var x=this.addOns.length,y=0;y<x;++y){var w=this.addOns[y],C=w.cost.mult(w.quantity);z.addOns[w.code]=C;z.allAddOns=z.allAddOns.add(C)}z.stages.recurring=z.plan.add(z.allAddOns);z.stages.now=z.plan.add(z.allAddOns);if(this.plan.trial){z.stages.now=h.Cost.FREE}if(this.plan.setupFee){z.stages.now=z.stages.now.add(this.plan.setupFee)}if(this.coupon){var A=z.stages.now;var B=z.stages.now.discount(this.coupon);z.coupon=B.sub(A);z.stages.now=B}if(this.billingInfo&&h.isVATChargeApplicable(this.billingInfo.country,this.billingInfo.vatNumber)){z.vat=z.stages.now.mult((h.settings.VATPercent/100));z.stages.now=z.stages.now.add(z.vat)}return z},redeemAddOn:function(x){var w=x.createRedemption();this.addOns.push(w);return w},removeAddOn:function(z){for(var x=this.addOns,w=x.length,y=0;y<w;++y){if(x[y].code==z){return x.splice(y,1)}}},findAddOnByCode:function(y){for(var w=this.addOns.length,x=0;x<w;++x){if(this.addOns[x].code==y){return this.addOns[x]}}return false},toJSON:function(){var A={plan_code:this.plan.code,quantity:this.plan.quantity,coupon_code:this.coupon?this.coupon.code:undefined,add_ons:[]};for(var z=0,y=this.addOns.length,x=A.add_ons,w=this.addOns;z<y;++z){x.push({add_on_code:w[z].code,quantity:w[z].quantity})}return A},save:function(w){var x={subscription:this.toJSON(),account:this.account.toJSON(),billing_info:this.billingInfo.toJSON()};f.ajax({url:h.settings.baseURL+"subscribe",data:x,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(y){if(y.success&&w.success){w.success(y.success)}else{if(y.errors&&w.error){var z=y.errors.error_code;delete y.errors.error_code;w.error(h.flattenErrors(y.errors),z)}}},error:function(){if(w.error){w.error(["Unknown error processing transaction. Please try again later."])}},complete:w.complete})}};h.AddOn.createRedemption=function(x){var w=s(this);w.quantity=x||1;return w};h.Coupon={fromJSON:function(w){var x=s(h.Coupon);if(w.discount_in_cents){x.discountCost=new h.Cost(-w.discount_in_cents)}else{if(w.discount_percent){x.discountRatio=w.discount_percent/100}}x.description=w.description;return x},toJSON:function(){}};h.Cost.prototype.discount=function(w){if(w.discountCost){return this.add(w.discountCost)}var x=this.sub(this.mult(w.discountRatio));if(x.cents()<0){return h.Cost.FREE}return x};h.Subscription.getCoupon=function(y,w,x){if(!h.settings.baseURL){h.raiseError("Company subdomain not configured")}return f.ajax({url:h.settings.baseURL+"plans/"+this.plan.code+"/coupons/"+y,dataType:"jsonp",jsonp:"callback",timeout:10000,success:function(A){if(A.valid){var z=h.Coupon.fromJSON(A);z.code=y;w(z)}else{x()}},error:function(){x()}})};h.Transaction={toJSON:function(){return{currency:this.currency,amount_in_cents:this.cost.cents()}},create:s,save:function(w){var x={transaction:this.toJSON(),account:this.account?this.account.toJSON():undefined,billing_info:this.billingInfo.toJSON(),signature:w.signature};f.ajax({url:h.settings.baseURL+"transactions/create",data:x,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(y){if(y.success&&w.success){w.success(y.success)}else{if(y.errors&&w.error){w.error(h.flattenErrors(y.errors))}}},error:function(){if(w.error){w.error(["Unknown error processing transaction. Please try again later."])}},complete:w.complete||f.noop})}};h.UserError={};function q(w,x){var y=s(h.UserError);y.validation=w;y.element=x;throw y}function u(A){try{A()}catch(z){if(!z.validation){throw z}var B=z.element;var y=h.locale.errors[z.validation.errorKey];var x=z.validation.validator;var w=f('<div class="error">');w.text(y);w.appendTo(B.parent());B.addClass("invalid");B.bind("change keyup",function(){if(x(B)){B.removeClass("invalid");w.remove();B.unbind()}});B.focus()}}function o(y,A,x){var C=y.find(A+" input");if(C.length==0){C=y.find(A+" select")}if(C.length==0){return undefined}var B=C.val();for(var z=2,w;w=arguments[z];++z){if(!w.validator(C)){q(w,C)}}return B}function c(x,w){return{validator:x,errorKey:w||x.defaultErrorKey}}function a(w){var x=w.find(".server_errors");x.removeClass("any").addClass("none");x.empty()}function m(x,B){var z=x.find(".server_errors");a(x);var w=B.length;if(w){z.removeClass("none").addClass("any");for(var A=0;A<w;++A){var y=f('<div class="error">');y.text(B[A]);z.append(y)}}}var j={contactInfo:{firstName:".contact_info > .full_name > .first_name > input",lastName:".contact_info > .full_name > .last_name > input",email:".contact_info > .email > input",phone:".contact_info > .phone > input",companyName:".contact_info > .company_name > input"},billingInfo:{firstName:".billing_info > .full_name > .first_name > input",lastName:".billing_info > .full_name > .last_name > input",address1:".billing_info > .address > .address1 > input",address2:".billing_info > .address > .address2 > input",country:".billing_info > .address > .country > select",city:".billing_info > .address > .city > input",state:".billing_info > .address > .state_zip > .state > input",zip:".billing_info > .address > .state_zip > .zip > input",vatNumber:".billing_info > .vat_number > input"}};function n(z,w,B){if(!w){return}for(var y in w){if(w.hasOwnProperty(y)&&B.hasOwnProperty(y)){var x=w[y];var A=B[y];if(typeof A=="string"){z.find(A).val(x).change()}else{if(typeof A=="object"){n(z,x,A)}}}}}function k(w,x){if(!x.collectPhone){w.find(".phone").remove()}if(!x.collectCompany){w.find(".company_name").remove()}w.delegate(".placeholder","click",function(){var y=f(this);var z=f(this).parent();z.find("input").focus()});w.delegate("input","change keyup",function(){var z=f(this);var y=f(this).parent();if(z.val().length>0){y.find(".placeholder").hide()}else{y.find(".placeholder").show()}});w.delegate("input","focus",function(){f(this).parent().addClass("focus")});w.delegate("input","blur",function(){f(this).parent().removeClass("focus")});w.delegate("input","keydown",function(y){if(y.keyCode>=48&&y.keyCode<=90){f(this).parent().find(".placeholder").hide()}});n(w,x.preFill,j)}function g(y,z){if(z.distinguishContactFromBillingInfo){var x=y.find(".contact_info .first_name input");var A=y.find(".contact_info .last_name input");var B=x.val();var w=A.val();y.find(".contact_info .first_name input").change(function(){var C=y.find(".billing_info .first_name input");if(C.val()==B){C.val(f(this).val()).change()}B=x.val()});y.find(".contact_info .last_name input").change(function(){var C=y.find(".billing_info .last_name input");if(C.val()==w){C.val(f(this).val()).change()}w=A.val()})}else{y.find(".billing_info .first_name, .billing_info .last_name").remove()}}function e(H,G){if(h.settings.country){var A=H.find(".country option[value="+h.settings.country+"]");if(A.length){A.attr("selected",true).change()}}var y=new Date();var F=y.getFullYear();var E=y.getMonth();var B=H.find(".year select");var w=H.find(".month select");for(var C=F;C<=F+10;++C){var x=f('<option name="'+C+'">'+C+"</option>");x.appendTo(B)}B.val(F+1);function D(){if(B.val()==F){w.find('option[value="'+E+'"]');var I=false;w.find("option").each(function(){if(f(this).val()<=E){f(this).attr("disabled",true)}else{f(this).removeAttr("disabled");if(!I){I=true;f(this).attr("selected",true)}}})}else{w.find("option").removeAttr("disabled")}}D();B.change(D);if(G.addressRequirement=="none"){H.find(".address").remove()}else{if(G.addressRequirement=="zip"){H.find(".address").addClass("only_zip");H.find(".address1, .address2, .city, .state").remove();if(!h.settings.VATPercent){H.find(".country").remove()}}else{if(G.addressRequirement=="zipstreet"){H.find(".address").addClass("only_zipstreet");H.find(".city, .state").remove();if(!h.settings.VATPercent){H.find(".country").remove()}}else{if(G.addressRequirement=="full"){H.find(".address").addClass("full")}}}}var z=H.find(".accepted_cards");H.find(".card_number input").bind("change keyup",function(){var I=h.detectCardType(f(this).val());if(I){z.find(".card").each(function(){f(this).toggleClass("match",f(this).hasClass(I));f(this).toggleClass("no_match",!f(this).hasClass(I))})}else{z.find(".card").removeClass("match no_match")}})}function i(w,y,x){y.firstName=o(w,".contact_info .first_name",c(h.isNotEmpty));y.lastName=o(w,".contact_info .last_name",c(h.isNotEmpty));y.companyName=o(w,".contact_info .company_name");y.email=o(w,".email",c(h.isNotEmpty),c(h.isValidEmail));y.code=x.accountCode}function d(w,y,x){y.firstName=o(w,".billing_info .first_name",c(h.isNotEmpty));y.lastName=o(w,".billing_info .last_name",c(h.isNotEmpty));y.number=o(w,".card_number",c(h.isNotEmpty),c(h.isValidCC));y.cvv=o(w,".cvv",c(h.isNotEmpty),c(h.isValidCVV));y.month=o(w,".month");y.year=o(w,".year");y.phone=o(w,".phone");y.address1=o(w,".address1",c(h.isNotEmpty));y.address2=o(w,".address2");y.city=o(w,".city",c(h.isNotEmpty));y.state=o(w,".state",c(h.isNotEmpty));y.zip=o(w,".zip",c(h.isNotEmpty));y.country=o(w,".country",c(function(z){return z.val()!="-"},"emptyField"))}function t(w){o(w,".accept_tos",c(h.isChecked))}h.buildBillingInfoUpdateForm=function(x){var y={addressRequirement:"full",distinguishContactFromBillingInfo:true};x=f.extend(s(h.settings),y,x);if(!x.accountCode){h.raiseError("accountCode missing")}if(!x.signature){h.raiseError("signature missing")}var z=h.BillingInfo.create();var w=f(h.updateBillingInfoFormHTML);w.find(".billing_info").html(h.billingInfoFieldsHTML);k(w,x);e(w,x);w.submit(function(A){A.preventDefault();a(w);w.find(".error").remove();w.find(".invalid").removeClass("invalid");u(function(){d(w,z,x);w.addClass("submitting");w.find("button.submit").attr("disabled",true).text("Please Wait");z.save({signature:x.signature,distinguishContactFromBillingInfo:x.distinguishContactFromBillingInfo,accountCode:x.accountCode,success:function(B){if(x.afterUpdate){x.afterUpdate(B)}if(x.successURL){var C=x.successURL;h.post(C,B,x)}},error:function(B){if(!x.onError||!x.onError(B)){m(w,B)}},complete:function(){w.removeClass("submitting");w.find("button.submit").removeAttr("disabled").text("Update")}})})});if(x.beforeInject){x.beforeInject(w.get(0))}f(function(){var A=f(x.target);A.html(w);if(x.afterInject){x.afterInject(w.get(0))}})};function v(w,x){if(x.termsOfServiceURL||x.privacyPolicyURL){var y=w.find(".accept_tos").html(h.termsOfServiceHTML);if(!(x.termsOfServiceURL&&x.privacyPolicyURL)){y.find("span.and").remove()}if(x.termsOfServiceURL){y.find("a.tos_link").attr("href",x.termsOfServiceURL)}else{y.find("a.tos_link").remove()}if(x.privacyPolicyURL){y.find("a.pp_link").attr("href",x.privacyPolicyURL)}else{y.find("a.pp_link").remove()}}else{w.find(".accept_tos").remove()}}h.buildTransactionForm=function(x){var z={addressRequirement:"full",distinguishContactFromBillingInfo:true,collectContactInfo:true};x=f.extend(s(h.settings),z,x);if(!x.collectContactInfo&&!x.accountCode){h.raiseError("collectContactInfo is false, but no accountCode provided")}if(!x.signature){h.raiseError("signature missing")}var B=h.BillingInfo.create(),y=h.Account.create(),A=h.Transaction.create();A.account=y;A.billingInfo=B;A.currency=x.currency;A.cost=new h.Cost(x.amountInCents);var w=f(h.oneTimeTransactionFormHTML);w.find(".billing_info").html(h.billingInfoFieldsHTML);if(x.collectContactInfo){w.find(".contact_info").html(h.contactInfoFieldsHTML)}else{w.find(".contact_info").remove()}k(w,x);g(w,x);e(w,x);v(w,x);w.submit(function(C){C.preventDefault();a(w);w.find(".error").remove();w.find(".invalid").removeClass("invalid");u(function(){i(w,y,x);d(w,B,x);t(w);w.addClass("submitting");w.find("button.submit").attr("disabled",true).text("Please Wait");A.save({signature:x.signature,accountCode:x.accountCode,success:function(D){if(x.afterPay){x.afterPay(D)}if(x.successURL){var E=x.successURL;h.post(E,D,x)}},error:function(D){if(!x.onError||!x.onError(D)){m(w,D)}},complete:function(){w.removeClass("submitting");w.find("button.submit").removeAttr("disabled").text("Pay")}})})});if(x.beforeInject){x.beforeInject(w.get(0))}f(function(){var C=f(x.target);C.html(w);if(x.afterInject){x.afterInject(w.get(0))}})};h.buildSubscriptionForm=function(x){var z={enableAddOns:true,enableCoupons:true,addressRequirement:"full",distinguishContactFromBillingInfo:false};x=f.extend(s(h.settings),z,x);var w=f(h.subscribeFormHTML);w.find(".contact_info").html(h.contactInfoFieldsHTML);w.find(".billing_info").html(h.billingInfoFieldsHTML);k(w,x);g(w,x);e(w,x);v(w,x);if(x.planCode){h.Plan.get(x.planCode,y)}else{if(x.plan){y(x.plan)}}function y(A){if(x.filterPlan){A=x.filterPlan(A)||A}var P=A.createSubscription(),B=h.Account.create(),I=h.BillingInfo.create();P.account=B;P.billingInfo=I;if(x.filterSubscription){P=x.filterSubscription(P)||P}if(!A.displayQuantity){w.find(".plan .quantity").remove()}if(A.setupFee){w.find(".subscription").addClass("with_setup_fee");w.find(".plan .setup_fee .cost").text(""+A.setupFee)}else{w.find(".plan .setup_fee").remove()}if(A.trial){w.find(".subscription").addClass("with_trial");w.find(".plan .free_trial").text("First "+A.trial+" free")}else{w.find(".plan .free_trial").remove()}function G(){var S=P.calculateTotals();w.find(".plan .recurring_cost .cost").text(""+S.plan);w.find(".due_now .cost").text(""+S.stages.now);w.find(".coupon .discount").text(""+(S.coupon||""));w.find(".vat .cost").text(""+(S.vat||""));w.find(".add_ons .add_on").each(function(){var T=f(this).data("add_on");if(f(this).hasClass("selected")){var U=S.addOns[T.code];f(this).find(".cost").text("+ "+U)}else{f(this).find(".cost").text("+ "+T.cost)}})}w.find(".plan .quantity input").bind("change keyup",function(){P.plan.quantity=parseInt(f(this).val(),10)||1;G()});w.find(".plan .name").text(A.name);w.find(".plan .recurring_cost .cost").text(""+A.cost);w.find(".plan .recurring_cost .interval").text("every "+A.interval);var E=w.find(".add_ons");if(x.enableAddOns){var M=A.addOns.length;if(M){E.removeClass("none").addClass("any");for(var N=0;N<M;++N){var J=A.addOns[N];var O="add_on add_on_"+J.code+(N%2?" even":" odd");if(N==0){O+=" first"}if(N==M-1){O+=" last"}var D=f('<div class="'+O+'"><div class="name">'+J.name+'</div><div class="field quantity"><div class="placeholder">Qty</div><input type="text"></div><div class="cost"/></div>');if(!J.displayQuantity){D.find(".quantity").remove()}D.data("add_on",J);D.appendTo(E)}E.delegate(".add_ons .quantity input","change keyup",function(V){var S=f(this).closest(".add_on");var U=S.data("add_on");var T=parseInt(f(this).val(),10)||1;P.findAddOnByCode(U.code).quantity=T;G()});E.bind("selectstart",function(S){if(f(S.target).is(".add_on")){S.preventDefault()}});E.delegate(".add_ons .add_on","click",function(W){if(f(W.target).closest(".quantity").length){return}var U=!f(this).hasClass("selected");f(this).toggleClass("selected",U);var V=f(this).data("add_on");if(U){var S=P.redeemAddOn(V);var T=f(this).find(".quantity input");S.quantity=parseInt(T.val(),10)||1;T.focus()}else{P.removeAddOn(V.code)}G()})}}else{E.remove()}var H=w.find(".coupon");var L=null;function Q(){var S=H.find("input").val();if(S==L){return}L=S;if(!S){H.removeClass("invalid").removeClass("valid");H.find(".description").text("");P.coupon=undefined;G();return}H.addClass("checking");P.getCoupon(S,function(T){H.removeClass("checking");P.coupon=T;H.removeClass("invalid").addClass("valid");H.find(".description").text(T.description);G()},function(){P.coupon=undefined;H.removeClass("checking");H.removeClass("valid").addClass("invalid");H.find(".description").text("Not Found");G()})}if(x.enableCoupons){H.find("input").bind("keyup change",function(S){});H.find("input").keypress(function(S){if(S.charCode==13){S.preventDefault();Q()}});H.find(".check").click(function(){Q()});H.find("input").blur(function(){H.find(".check").click()})}else{H.remove()}var C=w.find(".vat");var R=w.find(".vat_number");var K=R.find("input");C.find(".title").text("VAT at "+h.settings.VATPercent+"%");function F(){var T=w.find(".country select").val();var V=h.isVATNumberApplicable(T);R.toggleClass("applicable",V);R.toggleClass("inapplicable",!V);var U=K.val();var S=h.isVATChargeApplicable(T,U);C.toggleClass("applicable",S);C.toggleClass("inapplicable",!S)}w.find(".country select").change(function(){I.country=f(this).val();G();F()}).change();K.bind("keyup change",function(){I.vatNumber=f(this).val();G();F()});w.submit(function(S){S.preventDefault();a(w);w.find(".error").remove();w.find(".invalid").removeClass("invalid");u(function(){i(w,B,x);d(w,I,x);t(w);w.addClass("submitting");w.find("button.submit").attr("disabled",true).text("Please Wait");P.save({success:function(T){if(x.afterSubscribe){x.afterSubscribe(T)}if(x.successURL){var U=x.successURL;h.post(U,T,x)}},error:function(T){if(!x.onError||!x.onError(T)){m(w,T)}},complete:function(){w.removeClass("submitting");w.find("button.submit").removeAttr("disabled").text("Subscribe")}})})});G();if(x.beforeInject){x.beforeInject(w.get(0))}f(function(){var S=f(x.target);S.html(w);if(x.afterInject){x.afterInject(w.get(0))}})}};h.contactInfoFieldsHTML='<div class="title">Contact Info</div><div class="full_name"><div class="field first_name"><div class="placeholder">First Name </div><input type="text"/></div><div class="field last_name"><div class="placeholder">Last Name </div><input type="text"/></div></div><div class="field email"><div class="placeholder">Email </div><input type="text"/></div><div class="field phone"><div class="placeholder">Phone Number</div><input type="text"/></div><div class="field company_name"><div class="placeholder">Company/Organization Name</div><input type="text"/></div>';h.billingInfoFieldsHTML='<div class="title">Billing Info</div><div class="accepted_cards"><div class="card american_express">American Express</div><div class="card discover">Discover</div><div class="card mastercard">MasterCard </div><div class="card visa">Visa</div></div><div class="full_name"><div class="field first_name"><div class="placeholder">First Name </div><input type="text"/></div><div class="field last_name"><div class="placeholder">Last Name </div><input type="text"/></div></div><div class="credit_card"><div class="card_cvv"><div class="field card_number"><div class="placeholder">Credit Card Number  </div><input type="text"/></div><div class="field cvv"><div class="placeholder">CVV </div><input type="text"/></div><!-- :number, :maxlength => 22, :class => \'required creditcard\', :placeholder => \'Credit Card Number\'--></div><div class="field expires"><div class="title">Expires </div><div class="month"><select><option value="1">01 - January</option><option value="2">02 - February</option><option value="3">03 - March</option><option value="4">04 - April</option><option value="5">05 - May</option><option value="6">06 - June</option><option value="7">07 - July</option><option value="8">08 - August</option><option value="9">09 - September</option><option value="10">10 - October</option><option value="11">11 - November</option><option value="12">12 - December</option><!-- = render :partial => \'months\' --></select></div><div class="year"><select></select></div></div></div><div class="address"><div class="field address1"><div class="placeholder">Address</div><input type="text"/></div><div class="field address2"><div class="placeholder">Apt/Suite</div><input type="text"/></div><div class="field city"><div class="placeholder">City</div><input type="text"/></div><div class="state_zip"><div class="field state"><div class="placeholder">State/Province</div><input type="text"/></div><div class="field zip"><div class="placeholder">Zip/Postal</div><input type="text"/></div></div><div class="field country"><!-- label Country --><select><option value="-">Select Country</option><option value="-">-------------- </option><option value="AF">Afghanistan</option><option value="AL">Albania</option><option value="DZ">Algeria</option><option value="AS">American Samoa</option><option value="AD">Andorra</option><option value="AO">Angola</option><option value="AI">Anguilla</option><option value="AQ">Antarctica</option><option value="AG">Antigua and Barbuda</option><option value="AR">Argentina</option><option value="AM">Armenia</option><option value="AW">Aruba</option><option value="AC">Ascension(Island</option><option value="AU">Australia</option><option value="AT">Austria</option><option value="AZ">Azerbaijan</option><option value="BS">Bahamas</option><option value="BH">Bahrain</option><option value="BD">Bangladesh</option><option value="BB">Barbados</option><option value="BY">Belarus</option><option value="BE">Belgium</option><option value="BZ">Belize</option><option value="BJ">Benin</option><option value="BM">Bermuda</option><option value="BT">Bhutan</option><option value="BO">Bolivia</option><option value="BA">Bosnia and Herzegovina</option><option value="BW">Botswana</option><option value="BV">Bouvet Island</option><option value="BR">Brazil</option><option value="BQ">British Antarctic Territory</option><option value="IO">British Indian Ocean Territory</option><option value="VG">British Virgin Islands</option><option value="BN">Brunei</option><option value="BG">Bulgaria</option><option value="BF">Burkina Faso</option><option value="BI">Burundi</option><option value="KH">Cambodia</option><option value="CM">Cameroon</option><option value="CA">Canada</option><option value="IC">Canary Islands</option><option value="CT">Canton and Enderbury Islands</option><option value="CV">Cape Verde</option><option value="KY">Cayman Islands</option><option value="CF">Central African Republic</option><option value="EA">Ceuta and Melilla</option><option value="TD">Chad</option><option value="CL">Chile</option><option value="CN">China</option><option value="CX">Christmas Island</option><option value="CP">Clipperton Island</option><option value="CC">Cocos [Keeling] Islands</option><option value="CO">Colombia</option><option value="KM">Comoros</option><option value="CD">Congo [DRC]</option><option value="CG">Congo [Republic]</option><option value="CK">Cook Islands</option><option value="CR">Costa Rica</option><option value="HR">Croatia</option><option value="CU">Cuba</option><option value="CY">Cyprus</option><option value="CZ">Czech Republic</option><option value="DK">Denmark</option><option value="DG">Diego Garcia</option><option value="DJ">Djibouti</option><option value="DM">Dominica</option><option value="DO">Dominican Republic</option><option value="NQ">Dronning Maud Land</option><option value="DD">East Germany</option><option value="TL">East Timor</option><option value="EC">Ecuador</option><option value="EG">Egypt</option><option value="SV">El Salvador</option><option value="GQ">Equatorial Guinea</option><option value="ER">Eritrea</option><option value="EE">Estonia</option><option value="ET">Ethiopia</option><option value="EU">European Union</option><option value="FK">Falkland Islands [Islas Malvinas]</option><option value="FO">Faroe Islands</option><option value="FJ">Fiji</option><option value="FI">Finland</option><option value="FR">France</option><option value="GF">French Guiana</option><option value="PF">French Polynesia</option><option value="TF">French Southern Territories</option><option value="FQ">French Southern and Antarctic Territories</option><option value="GA">Gabon</option><option value="GM">Gambia</option><option value="GE">Georgia</option><option value="DE">Germany</option><option value="GH">Ghana</option><option value="GI">Gibraltar</option><option value="GR">Greece</option><option value="GL">Greenland</option><option value="GD">Grenada</option><option value="GP">Guadeloupe</option><option value="GU">Guam</option><option value="GT">Guatemala</option><option value="GG">Guernsey</option><option value="GN">Guinea</option><option value="GW">Guinea-Bissau</option><option value="GY">Guyana</option><option value="HT">Haiti</option><option value="HM">Heard Island and McDonald Islands</option><option value="HN">Honduras</option><option value="HK">Hong Kong</option><option value="HU">Hungary</option><option value="IS">Iceland</option><option value="IN">India</option><option value="ID">Indonesia</option><option value="IR">Iran</option><option value="IQ">Iraq</option><option value="IE">Ireland</option><option value="IM">Isle of Man</option><option value="IL">Israel</option><option value="IT">Italy</option><option value="CI">Ivory Coast</option><option value="JM">Jamaica</option><option value="JP">Japan</option><option value="JE">Jersey</option><option value="JT">Johnston Island</option><option value="JO">Jordan</option><option value="KZ">Kazakhstan</option><option value="KE">Kenya</option><option value="KI">Kiribati</option><option value="KW">Kuwait</option><option value="KG">Kyrgyzstan</option><option value="LA">Laos</option><option value="LV">Latvia</option><option value="LB">Lebanon</option><option value="LS">Lesotho</option><option value="LR">Liberia</option><option value="LY">Libya</option><option value="LI">Liechtenstein</option><option value="LT">Lithuania</option><option value="LU">Luxembourg</option><option value="MO">Macau</option><option value="MK">Macedonia [FYROM]</option><option value="MG">Madagascar</option><option value="MW">Malawi</option><option value="MY">Malaysia</option><option value="MV">Maldives</option><option value="ML">Mali</option><option value="MT">Malta</option><option value="MH">Marshall Islands</option><option value="MQ">Martinique</option><option value="MR">Mauritania</option><option value="MU">Mauritius</option><option value="YT">Mayotte</option><option value="FX">Metropolitan France</option><option value="MX">Mexico</option><option value="FM">Micronesia</option><option value="MI">Midway Islands</option><option value="MD">Moldova</option><option value="MC">Monaco</option><option value="MN">Mongolia</option><option value="ME">Montenegro</option><option value="MS">Montserrat</option><option value="MA">Morocco</option><option value="MZ">Mozambique</option><option value="MM">Myanmar [Burma]</option><option value="NA">Namibia</option><option value="NR">Nauru</option><option value="NP">Nepal</option><option value="NL">Netherlands</option><option value="AN">Netherlands Antilles</option><option value="NT">Neutral Zone</option><option value="NC">New Caledonia</option><option value="NZ">New Zealand</option><option value="NI">Nicaragua</option><option value="NE">Niger</option><option value="NG">Nigeria</option><option value="NU">Niue</option><option value="NF">Norfolk Island</option><option value="KP">North Korea</option><option value="VD">North Vietnam</option><option value="MP">Northern Mariana Islands</option><option value="NO">Norway</option><option value="OM">Oman</option><option value="QO">Outlying Oceania</option><option value="PC">Pacific Islands Trust Territory</option><option value="PK">Pakistan</option><option value="PW">Palau</option><option value="PS">Palestinian Territories</option><option value="PA">Panama</option><option value="PZ">Panama Canal Zone</option><option value="PG">Papua New Guinea</option><option value="PY">Paraguay</option><option value="YD">People\'s Democratic Republic of Yemen</option><option value="PE">Peru</option><option value="PH">Philippines</option><option value="PN">Pitcairn Islands</option><option value="PL">Poland</option><option value="PT">Portugal</option><option value="PR">Puerto Rico</option><option value="QA">Qatar</option><option value="RO">Romania</option><option value="RU">Russia</option><option value="RW">Rwanda</option><option value="RE">R\u00e9union</option><option value="BL">Saint Barth\u00e9lemy</option><option value="SH">Saint Helena</option><option value="KN">Saint Kitts and Nevis</option><option value="LC">Saint Lucia</option><option value="MF">Saint Martin</option><option value="PM">Saint Pierre and Miquelon</option><option value="VC">Saint Vincent and the Grenadines</option><option value="WS">Samoa</option><option value="SM">San Marino</option><option value="SA">Saudi Arabia</option><option value="SN">Senegal</option><option value="RS">Serbia</option><option value="CS">Serbia and Montenegro</option><option value="SC">Seychelles</option><option value="SL">Sierra Leone</option><option value="SG">Singapore</option><option value="SK">Slovakia</option><option value="SI">Slovenia</option><option value="SB">Solomon Islands</option><option value="SO">Somalia</option><option value="ZA">South Africa</option><option value="GS">South Georgia and the South Sandwich Islands</option><option value="KR">South Korea</option><option value="ES">Spain</option><option value="LK">Sri Lanka</option><option value="SD">Sudan</option><option value="SR">Suriname</option><option value="SJ">Svalbard and Jan Mayen</option><option value="SZ">Swaziland</option><option value="SE">Sweden</option><option value="CH">Switzerland</option><option value="SY">Syria</option><option value="ST">S\u00e3o Tom\u00e9 and Pr\u00edncipe</option><option value="TW">Taiwan</option><option value="TJ">Tajikistan</option><option value="TZ">Tanzania</option><option value="TH">Thailand</option><option value="TG">Togo</option><option value="TK">Tokelau</option><option value="TO">Tonga</option><option value="TT">Trinidad and Tobago</option><option value="TA">Tristan da Cunha</option><option value="TN">Tunisia</option><option value="TR">Turkey</option><option value="TM">Turkmenistan</option><option value="TC">Turks and Caicos Islands</option><option value="TV">Tuvalu</option><option value="UM">U.S. Minor Outlying Islands</option><option value="PU">U.S. Miscellaneous Pacific Islands</option><option value="VI">U.S. Virgin Islands</option><option value="UG">Uganda</option><option value="UA">Ukraine</option><option value="SU">Union(of Soviet Socialist Republics</option><option value="AE">United Arab Emirates</option><option value="GB">United Kingdom</option><option value="US">United States</option><option value="UY">Uruguay</option><option value="UZ">Uzbekistan</option><option value="VU">Vanuatu</option><option value="VA">Vatican City</option><option value="VE">Venezuela</option><option value="VN">Vietnam</option><option value="WK">Wake Island</option><option value="WF">Wallis and Futuna</option><option value="EH">Western Sahara</option><option value="YE">Yemen</option><option value="ZM">Zambia</option><option value="ZW">Zimbabwe</option><option value="AX">\u00c5land Islands</option></select></div></div><div class="field vat_number"><div class="placeholder">VAT Number</div><input type="text"/></div>';h.subscribeFormHTML='<form class="recurly subscribe"><div class="subscription"><div class="plan"><div class="name"></div><div class="field quantity"><div class="placeholder">Qty</div><input type="text"/></div><div class="recurring_cost"><div class="cost"></div><div class="interval"></div></div><div class="free_trial"></div><div class="setup_fee"><div class="title">Setup Fee</div><div class="cost"></div></div></div><div class="add_ons none"></div><div class="coupon"><div class="coupon_code field"><div class="placeholder">Coupon Code</div><input type="text" class="coupon_code"/></div><div class="check"></div><div class="description"></div><div class="discount"></div></div><div class="vat"><div class="title">VAT</div><div class="cost"></div></div></div><div class="due_now"><div class="title">Order Total</div><div class="cost"></div></div><div class="server_errors none"></div><div class="contact_info"></div><div class="billing_info"></div><div class="accept_tos"></div><div class="footer"><button type="submit" class="submit">Subscribe</button></div></form>';h.updateBillingInfoFormHTML='<form class="recurly update_billing_info"><div class="server_errors none"></div><div class="billing_info"></div><div class="footer"><button type="submit" class="submit">Update</button></div></form>';h.oneTimeTransactionFormHTML='<form class="recurly update_billing_info"><div class="server_errors none"></div><div class="contact_info"></div><div class="billing_info"></div><div class="accept_tos"></div><div class="footer"><button type="submit" class="submit">Pay</button></div></form>';h.termsOfServiceHTML='<input id="tos_check" type="checkbox"/><label id="accept_tos" for="tos_check">I accept the <a target="_blank" class="tos_link">Terms of Service</a><span class="and"> and </span><a target="_blank" class="pp_link">Privacy Policy</a></label>';window.Recurly=h}(jQuery));